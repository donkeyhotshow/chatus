// –î—Ä—É–∂–µ–ª—é–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

export const FriendlyMessages = {
    // –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
    networkError: [
        '–ù–µ –ª–æ–≤–∏—Ç —Å–µ—Ç—å üì°',
        '–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –∏–≥—Ä–∞–µ—Ç –≤ –ø—Ä—è—Ç–∫–∏ üôà',
        '–°–≤—è–∑—å –ø–æ—Ç–µ—Ä—è–ª–∞—Å—å üì∂',
        'WiFi —Ä–µ—à–∏–ª –æ—Ç–¥–æ—Ö–Ω—É—Ç—å üò¥',
    ],

    // –û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
    messageFailed: [
        '–°–æ–æ–±—â–µ–Ω–∏–µ –∑–∞—Å—Ç—Ä—è–ª–æ –≤ –ø—É—Ç–∏ üìÆ',
        '–ü–æ—á—Ç–∞–ª—å–æ–Ω –∑–∞–±–ª—É–¥–∏–ª—Å—è üì¨',
        '–ü–æ–ø—Ä–æ–±—É–µ–º –µ—â—ë —Ä–∞–∑? üîÑ',
        '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ ü§î',
    ],

    // –û—à–∏–±–∫–∏ —Ö–æ–ª—Å—Ç–∞
    canvasError: [
        '–ö–∏—Å—Ç–æ—á–∫–∞ —Å–ª–æ–º–∞–ª–∞—Å—å üñåÔ∏è',
        '–ö—Ä–∞—Å–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å üé®',
        '–•–æ–ª—Å—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç üñºÔ∏è',
        '–•—É–¥–æ–∂–Ω–∏–∫ —É—Å—Ç–∞–ª üòÖ',
    ],

    // –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    reconnecting: [
        '–ü—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è... üîÑ',
        '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–≤—è–∑—å... ‚ö°',
        '–ß–∏–Ω–∏–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç... üîß',
        '–í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ —Å–µ—Ç—å... üåê',
    ],

    // –£—Å–ø–µ—à–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
    success: [
        '–ì–æ—Ç–æ–≤–æ! ‚ú®',
        '–û—Ç–ª–∏—á–Ω–æ! üéâ',
        '–£—Å–ø–µ—Ö! üöÄ',
        '–ö—Ä—É—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å! üí´',
    ],

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    saved: [
        '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ! üíæ',
        '–ó–∞–ø–∏—Å–∞–ª–∏! ‚úçÔ∏è',
        '–í –∫–æ–ø–∏–ª–∫—É! üè¶',
        '–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ! üìå',
    ],

    // –ó–∞–≥—Ä—É–∑–∫–∞
    loading: [
        '–ó–∞–≥—Ä—É–∂–∞–µ–º... ‚è≥',
        '–ì–æ—Ç–æ–≤–∏–º –º–∞–≥–∏—é... ‚ú®',
        '–ü–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ... üéØ',
        '–°–µ–∫—É–Ω–¥–æ—á–∫—É... ‚è∞',
    ],

    // –û—à–∏–±–∫–∏ WebSocket
    websocketError: [
        '–ü–æ—Ç–µ—Ä—è–ª–∏ —Å–≤—è–∑—å —Å —Å–µ—Ä–≤–µ—Ä–æ–º üîå',
        '–°–µ—Ä–≤–µ—Ä –∑–∞–¥—É–º–∞–ª—Å—è... ü§î',
        '–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è... üîÑ',
        '–°–≤—è–∑—å –ø—Ä–µ—Ä–≤–∞–ª–∞—Å—å üì°',
    ],

    // –û—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    authError: [
        '–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ–π—Ç–∏ üîê',
        '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ üîÑ',
        '–ß—Ç–æ-—Ç–æ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π ü§∑',
        '–ù—É–∂–Ω–æ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è üö™',
    ],

    // –û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
    uploadError: [
        '–§–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è üìÅ',
        '–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª üì¶',
        '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª üîÑ',
        '–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å üòï',
    ],

    // –û—à–∏–±–∫–∏ –∏–≥—Ä
    gameError: [
        '–ò–≥—Ä–∞ —Å–ª–æ–º–∞–ª–∞—Å—å üéÆ',
        '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –≤ –∏–≥—Ä–µ üé≤',
        '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å üîÑ',
        '–ò–≥—Ä–æ–≤–æ–π —Å–±–æ–π üïπÔ∏è',
    ],

    // –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
    offline: [
        '–í—ã –æ—Ñ—Ñ–ª–∞–π–Ω üì¥',
        '–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É üåê',
        '–†–∞–±–æ—Ç–∞–µ–º –±–µ–∑ —Å–µ—Ç–∏ üìµ',
        '–°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è –ø–æ–∑–∂–µ üì®',
    ],

    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    connectionRestored: [
        '–°–≤—è–∑—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞! üéâ',
        '–°–Ω–æ–≤–∞ –æ–Ω–ª–∞–π–Ω! üåê',
        '–ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å! ‚ú®',
        '–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –≤–µ—Ä–Ω—É–ª—Å—è! üì∂',
    ],
} as const;

export function getRandomMessage(category: keyof typeof FriendlyMessages): string {
    const messages = FriendlyMessages[category];
    return messages[Math.floor(Math.random() * messages.length)];
}

// –ú–∞–ø–ø–∏–Ω–≥ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
const errorPatterns: Array<{ pattern: RegExp; category: keyof typeof FriendlyMessages }> = [
    { pattern: /network|fetch|net::err|failed to fetch/i, category: 'networkError' },
    { pattern: /websocket|socket|disconnect|ws:/i, category: 'websocketError' },
    { pattern: /failed to send|message.*fail|send.*error/i, category: 'messageFailed' },
    { pattern: /canvas|draw|paint|render/i, category: 'canvasError' },
    { pattern: /connect|timeout|timed out|ETIMEDOUT/i, category: 'reconnecting' },
    { pattern: /auth|login|permission|denied|unauthorized|401|403/i, category: 'authError' },
    { pattern: /upload|file.*size|too large|payload/i, category: 'uploadError' },
    { pattern: /game|play|score|match/i, category: 'gameError' },
    { pattern: /offline|no.*connection|navigator\.online/i, category: 'offline' },
];

// –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –≤ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–µ
export function humanizeError(error: string | Error): string {
    const errorString = typeof error === 'string' ? error : error.message;
    const lowerError = errorString.toLowerCase();

    // –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω
    for (const { pattern, category } of errorPatterns) {
        if (pattern.test(lowerError)) {
            return getRandomMessage(category);
        }
    }

    // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—â–µ–µ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    return '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –Ω–æ –º—ã —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏–º! üõ†Ô∏è';
}

// –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–¥–ª—è –ª–æ–≥–æ–≤)
export function getDetailedError(error: string | Error): string {
    if (typeof error === 'string') return error;
    return `${error.name}: ${error.message}${error.stack ? `\n${error.stack}` : ''}`;
}

// –≠–º–æ–¥–∑–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
export const NotificationEmojis = {
    success: ['‚ú®', 'üéâ', 'üöÄ', 'üí´', '‚≠ê'],
    error: ['üòÖ', 'ü§î', 'üòä', 'üôà', 'üîß'],
    warning: ['‚ö†Ô∏è', 'üì°', 'üîÑ', '‚è∞', 'üåê'],
    info: ['üí°', 'üì¢', 'üîî', 'üìå', 'üí¨'],
} as const;

export function getRandomEmoji(type: keyof typeof NotificationEmojis): string {
    const emojis = NotificationEmojis[type];
    return emojis[Math.floor(Math.random() * emojis.length)];
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
export interface FormattedError {
    title: string;
    description: string;
    emoji: string;
    canRetry: boolean;
    retryLabel?: string;
}

export function formatErrorForUser(error: string | Error): FormattedError {
    const errorString = typeof error === 'string' ? error : error.message;
    const lowerError = errorString.toLowerCase();

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏ –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
    if (/network|fetch|offline/i.test(lowerError)) {
        return {
            title: '–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é',
            description: getRandomMessage('networkError'),
            emoji: 'üì°',
            canRetry: true,
            retryLabel: '–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞',
        };
    }

    if (/websocket|disconnect/i.test(lowerError)) {
        return {
            title: '–ü–æ—Ç–µ—Ä—è–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ',
            description: getRandomMessage('websocketError'),
            emoji: 'üîå',
            canRetry: true,
            retryLabel: '–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è',
        };
    }

    if (/auth|permission|denied/i.test(lowerError)) {
        return {
            title: '–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞',
            description: getRandomMessage('authError'),
            emoji: 'üîê',
            canRetry: false,
        };
    }

    if (/upload|file/i.test(lowerError)) {
        return {
            title: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏',
            description: getRandomMessage('uploadError'),
            emoji: 'üìÅ',
            canRetry: true,
            retryLabel: '–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–Ω–æ–≤–∞',
        };
    }

    // –û–±—â–∞—è –æ—à–∏–±–∫–∞
    return {
        title: '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫',
        description: humanizeError(error),
        emoji: 'ü§î',
        canRetry: true,
        retryLabel: '–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞',
    };
}
