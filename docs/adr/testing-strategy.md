# ADR: Стратегия тестирования ChatService

## Контекст
- Нужны проверяемые сценарии без реального доступа к Firebase.
- Приоритет: стабильность и предсказуемость, минимальная стоимость запуска.
- Стек проекта — Next.js + TypeScript, без сборки Vite.

## Решение
- **Vitest** как раннер: быстрый старт, поддержка ESM, хорошие моки/таймеры.
- **Моки Firebase**: в unit-тестах мокируем `firebase/firestore|auth|storage` для проверки логики (cooldown, mute, reactions, batch clear).
- **Структура тестов**: `tests/chat-service/ChatService.test.ts`, setup `tests/setup/vitest.setup.ts`.
- **Скрипт**: `npm run test:unit`.

## Почему не Jest
- Jest требует отдельной конфигурации транспайла и медленнее на ESM.
- Vitest проще интегрируется с alias `@` и быстрыми таймерами.

## Последствия
### Плюсы
- Быстрые unit-тесты без запуска эмуляторов.
- Полный контроль таймеров для rate limiting/mute.
- Малый порог входа для будущих тестов.
### Минусы
- Интеграция с реальным Firestore не покрыта (надо добавить интеграционные тесты отдельно, через `@firebase/rules-unit-testing` + эмулятор).

## Статус
Принято.

